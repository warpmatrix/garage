# 概述

计算机系统自下而上的划分：硬件、操作系统、应用程序、用户

- 操作系统管理硬件、为应用程序提供基础、作为硬件与用户的中介

操作系统的作用：控制管理计算机的软硬资源、合理调度计算机的资源、提供接口和环境

- 计算机资源的管理者：
  - 处理机管理（进程管理）：以进程为基本单位，进程控制、进程同步、进程通讯、死锁、处理机调度
  - 存储器管理（内存管理）：内存的分配和回收、地址映射、内存保护与共享、内存扩充
  - 文件管理：文件存储空间的管理、目录管理、文件读写管理和保护
  - 设备管理（IO 管理）：缓冲管理、设备分配、设备处理、虚拟设备管理
- 提供用户接口：
  - 命令接口：组织和控制作业的执行
    - 联机命令接口（交互式命令接口）：用户发出一条指令，计算机执行一条指令，适用于分时/实时系统
    - 脱机命令接口（批处理命令接口）：用户发出一组作业控制命令执行，适用于批处理系统
  - 程序接口：由系统调用组成，在程序中使用通过系统调用使用计算机的服务
    - 图形用户界面（图形接口 GUI）不是操作系统的一部分，使用的系统调用才是
- 扩充机器：覆盖软件方便使用，使计算机变为扩充机器（虚拟机）
  - 裸机：没有软件支持的计算机

操作系统的特征：并发、共享（两个最基本的特征）、虚拟、异步

- 并发执行：具有一段时间内处理调度多个程序同时执行的能力，通过分时实现
  - 并行：在**同一时刻**支持若干事件同时完成
    - 程序的并行执行需要硬件的支持，如：多流水线和多处理机
  - 并发：在**同一时间段内**发生若干个事件
- 资源共享：系统的资源被多个并发执行的进程共同使用
  - 互斥共享：一段时间内只有一个进程允许访问该资源，访问的资源称为临界资源（独占资源）
    - 以进程为单位划分访问，当进程访问完毕并释放才允许另一个进程进行访问
  - 同时访问：允许多个进程在一段时间内同时访问资源
    - 宏观并发访问，微观串行访问，实现分时共享
- 虚拟：将物理实体使用逻辑虚拟进行映射
  - 不同的虚拟技术：时分复用技术（多用户复用处理器）、空分复用技术（扩充大小）
  - 不同的映射对象：虚拟处理器（时分复用）、虚拟内存（空分复用）、虚拟外设（时分复用）
- 异步：并发执行进程，进程的运行和环境相关，可能出现和时间相关的错误

操作系统的发展：

1. 手工操作阶段：无操作系统，手工完成程序装入运行输出
   - 没有用户管理，用户独占主机，人机速度差异大，需要等待用户操作，资源利用率低
2. 批处理系统
   - 单道批处理阶段：解决人机矛盾，**自动**装载程序、**顺序**执行程序、每次仅执行**单道**程序
     - 高速 CPU 需要等待低速 IO 设备
   - 多道批处理系统：剁成程序同时进入内存交替运行，实现各部件并行工作
     - 多道程序，宏观并发执行、微观串行执行，资源利用率高吞吐量大，但不提供人机交互能力
     - 主要解决：处理器分配、内存分配、IO 分配、安全性和一致性的保证
3. 分时操作系统：通过时分复用技术划分时间片，多个用户同时共享主机进行交互而不互相影响
   - 主要特性：同时性、交互性、独立性、及时性
4. 实时操作系统：在规定时间限制内完成任务，无需时间片排队。主要特点：及时、可靠
   - 硬实时系统：在规定的时间内必须完成动作
   - 软实时系统：可以接受偶尔违反时间规定，不会造成永久损害
5. 网络操作系统和分布式计算机系统：
   - 网络操作系统：通过计算机网络连接各台计算机进行使用，实现资源共享和计算机通信
   - 分布式操作系统：各台计算机由相同的地位，资源所有用户共享，任意计算机构成一个子系统
     - 并行协同完成任务。主要特点：分布式和并行性
6. 个人计算机操作系统、嵌入式操作系统、智能手机操作系统、服务器操作系统

## 操作系统的运行环境

CPU 执行的两类程序：

- 内核程序：操作系统的管理程序可以执行特权指令
  - 特权指令：涉及计算机系统的核心控制，不允许用户直接使用
- 用户自编程序：系统外部的应用程序

CPU 的两个状态：

- 用户态（目态）：应用程序运行时 CPU 的状态，不允许执行特权指令
- 核心态（管态、内核态）：操作系统内核程序执行时 CPU 的状态，允许执行特权指令
  - 运行在核心态的程序：和硬件相关的模块、管理程序

操作系统的主要运行机制：

- 时钟管理：计时，提供标准的系统时间；时钟中断，可以实现进程的切换
- 中断机制：通过保护和恢复中断，实现控制权的转移，提高计算机系统各个设备的利用率（[机组中的中断和异常](../Computer-Composition/7-输入输出.md)
- 原语：不允许中断，不可分割的基本单位。可以被调用的公共小程序，具有原子性（完成或不进行）
- 控制系统资源的数据结构：作业控制块、进程控制块、设备控制块、消息队列、缓冲区、空闲区分配表、内存分配表
- 系统调用：程序通过陷入指令调用操作系统提供的公共子程序
  - 陷入指令（访管指令）：将控制权交给操作系统内核程序，从用户态进入核心态，只能用户态下使用，不是特权指令
  - 功能分类：设备管理、文件管理、进程控制、进程通信、内存管理

进入核心态的方式：系统调用、中断、错误状态、执行特权指令
