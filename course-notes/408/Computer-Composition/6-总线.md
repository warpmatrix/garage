# 总线

解决 IO 设备和主机之间连接的灵活性问题，由分散连接发展为总线连接

总线：为多个部件分时共享的公共信息传送线路，特点为分时共享

- 分时：同一时刻只能有一个部件向总线发送信息，多个部件发送信息需要分时发送
- 共享：总线上可以挂载多个部件，各个部件传输信息通过总线共享
- 总线设备：设备对总线是否具有控制功能
  - 主设备：可以获得总线控制权的设备
  - 从设备：被主设备访问的设备，只能响应总线命令
- 总线特性：机械特性（尺寸、形状）、电气特性（电平范围）、功能特性、时间特性（时序特性）
- 猝发传送方式：在一个总线周期内，传输存储地址连续多个数据字

总线的分类：

- 片内总线：芯片内部的总线，连接寄存器、ALU 等设备
- 系统总线：计算机系统功能部件的总线，连接 CPU、内存、IO 接口等。分为三类：
  - 数据总线：传输数据，双向传输总线，位数与机器字长和存储字长相关
  - 地址总线：传输数据总线上源数据和目标数据的地址，单项传输总线，位数与内存地址空间大小相关
  - 控制总线：传输控制信息（CPU 的控制命令、内存或外设的反馈信号）
- 通信总线（外部总线）：计算机系统或其它系统之间传送信息的总线
  - 按时序控制划分：同步总线和异步总线
  - 按传输格式划分：并行总线和串行总线

总线的结构：

- 单总线结构：CPU、内存、IO 设备挂载在同一组总线，一组总线可以有多根信号线
  - 不同设备直接进行信息交换，结构简单成本低，易于接入新的设备
  - 带宽低、负载高，部件竞争同一总线，且不支持并发操作
- 双总线结构：两组总线（主存总线和 IO 总线）
  - 主存总线用于 CPU、内存和通道之间交换数据；IO 总线用于多个外设和通道进行数据传送
  - 将低速的 IO 设备从单总线上分离，实现存储器总线和 IO 总线分离
  - 但需要增加通道等额外的硬件设备
- 三总线结构：主存总线、IO 总线、DMA 总线
  - 主存总线用于 CPU 和内存通信，IO 总线用于 CPU 和外设通信，DMA 总线用于 内存和高速外设之间通信
  - 提高 IO 设备的性能，提高系统的吞吐量；但系统工作效率较低

总线的性能指标：总线宽度、总线频率、总线带宽是最主要的指标

- 总线传送周期（总线周期）：一次总线操作的时间（申请、寻址、传输、结束），由若干总线时钟周期组成
- 总线时钟周期：机器的时钟周期
- 总线的工作频率：总线周期的倒数。若总线周期 = $N$ 时钟周期，则工作频率 = 时钟频率 $/ N$
- 总线的时钟频率：机器的时钟频率，时钟周期的倒数
- 总线宽度（总线位宽）：总线上能同时传输的数据位数，通常指数据总线的根数
- 总线带宽：单位时间内总线传输数据的位数 (B/s)，**总线工作频率 $\times$ 总线宽度**
- 总线复用：信号线在不同的事件传输不同的信息，节省空间和成本
- 信号线数：三类总线的信号线数量之和

总线传输的四个阶段：

1. 申请分配阶段：主设备（主模块）向总线仲裁机构申请总线使用权
    - 可以细分为传输请求和总线仲裁两个阶段
2. 寻址阶段：主设备过总线发送从设备（从模块）的地址和指令，启动从设备
3. 传输阶段：主模块和从模块进行数据交换
4. 结束阶段：主模块的信息从总线上撤除，让出总线的使用权

总线的定时方式：

- 同步定时：系统使用统一的时钟信号协调发送方和接收方的定时关系，发送接受都在总线传送周期完成
  - 传送速度快，逻辑简单；但主从设备强制同步，不能及时进行有效性检验，可靠性较差
  - 适用于总线长度较短，发送方和接收方存取事件接近的系统
- 异步定时：没有统一的时钟，没有固定的时间间隔，依靠握手信号实现定时控制
  - 主设备提出请求信号，从设备发送回答信号
  - 总线周期长度可变，保证两个工作速度相差很大的设备可以可靠进行信息交换，自动适应时间配合
  - 比同步控制方式更复杂，速度比同步定时慢
  - 请求信号和回答信号的互锁方式分为：
    - 不互锁方式：请求信号和回答信号的撤销不存在锁关系
    - 半互锁方式：请求信号需要等到从设备的回答信号才能撤销，从设备的回答信号可以自行撤销
    - 全互锁方式：请求信号需要等到回答信号才能撤销，回答信号都要等到主设备获知才能撤销

总线标准：ISA、EISA、VESA、PCI、PCI-E、AGP、RS-232C、USB、PCMCIA、IDE、SCSI、SATA
